import './home.page.css';
import { useState, useEffect, useRef } from 'react';
export const TerminalCommand = ({}) => {
  const caretRef = useRef();
  const contentRef = useRef();
  
  const setCaret = () => {
    console.log(window.getSelection().focusOffset)
    caretRef.current.style.left = `${window.getSelection().focusOffset}ch`;
  }

  useEffect(() => {
    setCaret(); 
    contentRef.current.focus();
  }, []);

  const onKeyDown = (e) => {
    if (e.key === "Enter") {
      // contentRef.current.replaceChildren();
      // TODO: sendEvent to terminal and set the result below
      e.preventDefault();
    }
    setCaret();
  }


  return (
    <div>
      <div className="terminal-command">
        <span className="command-prefix"><span className="user">guest@lukes-portfolio:</span><span className="cwd">~</span><span className="white">$</span></span>
        <div className="terminal-input"> 
          <div ref={caretRef} className="terminal-caret"></div>
          <div onKeyDown={ onKeyDown } ref={contentRef} onFocus={ setCaret } onClick={ setCaret } className="terminal-contents" onInput={ setCaret } contentEditable></div>
        </div>
      </div>
      <div className="command-output">
        This is my text:
        here's a new line
      </div>
    </div>
  );
}

export const Terminal = () => {
  return (
    <div className="terminal">
      <TerminalCommand ></TerminalCommand>
    </div>
  );
}
